<!DOCTYPE html>
<html lang="en" dir="ltr" class="dark-mode">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Luma</title>

    <!-- Prevent the demo from appearing in search engines -->
    <meta name="robots" content="noindex">

    <link href="https://fonts.googleapis.com/css?family=Lato:400,700%7CRoboto:400,500%7CExo+2:600&display=swap"
        rel="stylesheet">

    <!-- Preloader -->
    <link type="text/css" href="public/vendor/spinkit.css" rel="stylesheet">

    <!-- Perfect Scrollbar -->
    <link type="text/css" href="public/vendor/perfect-scrollbar.css" rel="stylesheet">

    <!-- Material Design Icons -->
    <link type="text/css" href="public/css/material-icons.css" rel="stylesheet">

    <!-- Font Awesome Icons -->
    <link type="text/css" href="public/css/fontawesome.css" rel="stylesheet">

    <!-- Preloader -->
    <link type="text/css" href="public/css/preloader.css" rel="stylesheet">

    <!-- App CSS -->
    <link type="text/css" href="public/css/app.css" rel="stylesheet">

    <!-- Dark Mode CSS -->
    <link type="text/css" href="public/css/dark.css" rel="stylesheet">

    <!-- my css styles -->
    <link rel="stylesheet" href="myCss/mine.css">

    <!-- my added bootstrap.css -->
    <!-- <link rel="stylesheet" type="text/css" href="myCss/bootstrap.css"> -->

</head>

<body class="layout-app ">



    <div class="preloader">
        <div class="sk-chase">
            <div class="sk-chase-dot"></div>
            <div class="sk-chase-dot"></div>
            <div class="sk-chase-dot"></div>
            <div class="sk-chase-dot"></div>
            <div class="sk-chase-dot"></div>
            <div class="sk-chase-dot"></div>
        </div>


    </div>

    <!-- Drawer Layout -->



    <div class="mdk-drawer-layout js-mdk-drawer-layout" data-push data-responsive-width="992px">
        <div class="mdk-drawer-layout__content page-content">

            <!-- Header -->

            <div id="myHeader"></div>

            <!-- // END Header -->

            <!-- BEFORE Page Content -->

            <!-- // END BEFORE Page Content -->

            <!-- Page Content -->
            <div class="page-section border-bottom-2">
                <div class="container page__container">


                    <div class="pt-32pt">
                        <div class="container page__container d-flex flex-column flex-md-row align-items-center text-center text-sm-left">
                            <div class="flex d-flex flex-column flex-sm-row align-items-center">

                                <div class="mb-24pt mb-sm-0 mr-sm-24pt">
                                    <h2 class="mb-0">Trainer Information</h2>

                                    <ol class="breadcrumb p-0 m-0">
                                        <li class="breadcrumb-item"><a href="index.html">Home</a></li>

                                        <li class="breadcrumb-item">

                                            <a href="">Account</a>

                                        </li>

                                        <li class="breadcrumb-item active">

                                            Edit Account

                                        </li>

                                    </ol>

                                </div>
                            </div>

                        </div>
                    </div>

                    <!-- BEFORE Page Content -->

                    <!-- // END BEFORE Page Content -->

                    <!-- Page Content -->

                    <div class="container page__container page-section">
                        <div class="page-separator">
                            <div class="page-separator__text">Basic Information</div>
                        </div>
                        <div class="col-md-6 p-0">
                            <form id="uploadForm" action="api/vwTrainers.php" method="POST" enctype="multipart/form-data">
                                <div class="form-group">
                                    <label class="form-label">Trainer Image</label>
                                    <input type="file" id="trainerImage" name="trainerImage" class="form-control-file">
                                    <img id="previewImage" name="previewImage" src="https://www.kindpng.com/picc/m/451-4517876_default-profile-hd-png-download.png" alt="Trainer Image" style="max-width: 200px; margin-top: 10px;">
                                    <br></br>

                                    <label class="form-label">First name</label>
                                    <input type="text"
                                           id="firstName"
                                           name="firstName"
                                           class="form-control"
                                           value=""
                                           placeholder="Your first name ...">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Last name</label>
                                    <input type="text"
                                           id="lastName"
                                           name="lastName"
                                           class="form-control"
                                           value=""
                                           placeholder="Your last name ...">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Email address</label>
                                    <input type="email"
                                           id="email"
                                           name="email"
                                           class="form-control"
                                           value=""
                                           placeholder="Your email address ...">
                                    <small class="form-text text-muted">Note that if you change your email, you will have to confirm it again.</small>
                                </div>
                                <button id="saveChangesBtn" name="saveChangesBtn" class="btn btn-primary">Save changes</button>
                            </form>
                        </div>
                    </div>

                </div>
            </div>



            <div id="myFooter"></div>
        </div>

        <!-- // END drawer-layout__content -->

        <!-- Drawer -->

        <div class="mdk-drawer js-mdk-drawer" id="default-drawer">
            <div class="mdk-drawer__content">
                <div class="sidebar sidebar-black-dodger-blue sidebar-left" data-perfect-scrollbar>
                    <div id="mySidebar"></div>
                    <!-- Sidebar Content -->
                </div>
            </div>

            <!-- // END Drawer -->

        </div>
    </div>


    <!-- // END Drawer Layout -->

    <!-- Header -->
    <script src="components/header.js"></script>

    <!-- Footer -->
    <script src="components/footer.js"></script>

    <!-- sidebar -->
    <script src="components/sidebar.js"></script>
    <!-- jQuery -->
    <script src="public/vendor/jquery.min.js"></script>

    <!-- Bootstrap -->
    <script src="myJS/bootstrap.bundle.min.js"></script>
    <script src="public/vendor/popper.min.js"></script>
    <script src="public/vendor/bootstrap.min.js"></script>

    <!-- Perfect Scrollbar -->
    <script src="public/vendor/perfect-scrollbar.min.js"></script>

    <!-- DOM Factory -->
    <script src="public/vendor/dom-factory.js"></script>

    <!-- MDK -->
    <script src="public/vendor/material-design-kit.js"></script>

    <!-- App JS -->
    <script src="public/js/app.js"></script>

    <!-- Preloader -->
    <script src="public/js/preloader.js"></script>


    <!-- added scripts not included in template -->
    <!-- Datatable js-->
    <script src="myJS/datatables/jquery.dataTables.min.js"></script>
    <script src="myJS/datatables/custom-basic.js"></script>
    <script src="myJS/QueryStringDivider.js"></script>

    <script>
        const urlParams = new URLSearchParams(window.location.search);
        const userId = urlParams.get('userId');
        $('#trainerImage').change(function() {
    var file = this.files[0];
    if (file) {
        var reader = new FileReader();
        reader.onload = function(event) {
            $('#previewImage').attr('src', event.target.result);
        };
        reader.readAsDataURL(file);
    } else {
        // Show default image if no file selected
        $('#previewImage').attr('src', 'https://www.kindpng.com/picc/m/451-4517876_default-profile-hd-png-download.png');
    }
});

       
        function saveChanges() {
            var firstName = $('#firstName').val();
            var lastName = $('#lastName').val();
            var email = $('#email').val();
            var imageUrl = $('#previewImage').attr('src');

            const formData = new FormData();

            var file = $('#trainerImage')[0].files[0];
    if (file) {
        formData.append('trainerImage', file);
    }
             

            formData.append('firstName', firstName);
            formData.append('lastName', lastName);
            formData.append('email', email);
            formData.append('imageUrl', imageUrl);

            
if(userId!=null){
    formData.append('id', userId);
            $.ajax({
                
                url: 'api/vwTrainers.php?status=update',
                method: 'POST',
                data: formData,
                processData: false,  // Important: Don't process data
        contentType: false,
                success: function(response) {
                    console.log("successful" + response);
                },
                error: function(xhr) {
                    console.error(xhr.responseText);
                }
            });}
            else{
                $.ajax({
                url: 'api/vwTrainers.php?status=new',
                method: 'POST',
                data:formData,
                processData: false,  // Important: Don't process data
        contentType: false,
                success: function(response) {
                    console.log("successful" + response);
                },
                error: function(xhr) {
                    console.error(xhr.responseText);
                }
            });

            }
        }

        function populateNames() {
            const userId = urlParams.get('userId');
                $.ajax({
                    url: 'api/vwTrainers.php',
                    method: 'GET',
                    data: {
                        status: 'one',
                        id: userId
                    },
                    success: function(response) {
                        var data = JSON.parse(response);
            if (data.length > 0) {
                console.log(data[0])
                $('#firstName').val(data[0].firstName);
                $('#lastName').val(data[0].lastName);
                $('#email').val(data[0].email);
                
                // Display the image
                $('#previewImage').attr('src', data[0].imageUrl);
            } else {
                $('#firstName').val('Error: User data not found');
            }
        },
                    error: function(xhr) {
                        console.error(xhr.responseText);
                        $('#firstName').val('Error: Unable to fetch user data');
                    }
                });
            
        }

        $(document).ready(function() {
            if(userId!=null){
            populateNames();}
            $('#saveChangesBtn').click(function(e) {
                event.preventDefault();
                saveChanges(e);
                window.location.href = 'trainers.html';
            });
        });
    </script>



</body>

</html>
