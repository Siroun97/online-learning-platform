<!DOCTYPE html>
<html lang="en" dir="ltr" class="dark-mode">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Luma</title>

    <!-- Prevent the demo from appearing in search engines -->
    <meta name="robots" content="noindex">

    <link href="https://fonts.googleapis.com/css?family=Lato:400,700%7CRoboto:400,500%7CExo+2:600&display=swap"
        rel="stylesheet">

    <!-- Preloader -->
    <link type="text/css" href="public/vendor/spinkit.css" rel="stylesheet">

    <!-- Perfect Scrollbar -->
    <link type="text/css" href="public/vendor/perfect-scrollbar.css" rel="stylesheet">

    <!-- Material Design Icons -->
    <link type="text/css" href="public/css/material-icons.css" rel="stylesheet">

    <!-- Font Awesome Icons -->
    <link type="text/css" href="public/css/fontawesome.css" rel="stylesheet">

    <!-- Preloader -->
    <link type="text/css" href="public/css/preloader.css" rel="stylesheet">

    <!-- App CSS -->
    <link type="text/css" href="public/css/app.css" rel="stylesheet">

    <!-- Dark Mode CSS -->
    <link type="text/css" href="public/css/dark.css" rel="stylesheet">

    <!-- my css styles -->
    <link rel="stylesheet" href="myCss/mine.css">

    <!-- my added bootstrap.css -->
    <!-- <link rel="stylesheet" type="text/css" href="myCss/bootstrap.css"> -->
</head>

<body class="layout-app ">

    <!-- Modal -->
    <div class="modal fade" id="myModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <form class="modal-content bg-dark" id="myForm">
                <div class="d-flex justify-content-between w-100 p-3">
                    <!-- Close button at the left end -->
                    <h3 class="modal-title " id="exampleModalLabel">Course course</h1>
                        <button type="button" class="btn-close btn-close-white " data-bs-dismiss="modal"
                            aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <input type="text" id="courseId" name="courseId" value="-1" hidden="" placeholder="Enter course ID">
                    
                    <div class="form-floating mb-3">
                        <input type="text" class="form-control input-text" id="courseName"
                            placeholder="Enter name" name="courseName">
                        <label for="courseName">name</label>

                       
                    </div>
                    <!-- <div class="form-floating mb-3">
                        <input type="hidden" class="f../bootorm-control" id="isActive" name="isActive">
                    </div>
                    <div class="toggle-icon" id="toggleButton">
                        <div class="label-box">Active</div>
                        <i id="icon" class="fa fa-check"></i>
                    </div> -->
                    <input type="text" id="trainerId" name="trainerId" value="" hidden="" placeholder="Enter trainer ID">
                </div>
                <div class="modal-footer">
                    <button type="submit" class="btn btn-primary" id="save">Save</button>
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </form>
        </div>
    </div>

    <div class="preloader">
        <div class="sk-chase">
            <div class="sk-chase-dot"></div>
            <div class="sk-chase-dot"></div>
            <div class="sk-chase-dot"></div>
            <div class="sk-chase-dot"></div>
            <div class="sk-chase-dot"></div>
            <div class="sk-chase-dot"></div>
        </div>


    </div>

    <!-- Drawer Layout -->

    <div class="mdk-drawer-layout js-mdk-drawer-layout" data-push data-responsive-width="992px">
        <div class="mdk-drawer-layout__content page-content">

            <!-- Header -->

            <div id="myHeader"></div>

            <!-- // END Header -->

            <!-- BEFORE Page Content -->

            <!-- // END BEFORE Page Content -->

            <!-- Page Content -->

            <div class="mdk-box mdk-box--bg-primary bg-dark js-mdk-box mb-0"
                data-effects="parallax-background blend-background">
                <div class="mdk-box__bg">
                    <div class="mdk-box__bg-front"
                        style="background-image: url(public/images/1280_work-station-straight-on-view.jpg);">
                    </div>
                </div>


                <div class="mdk-box__content justify-content-center">
                    <div class="hero container page__container text-center py-112pt">
                        <div class="d-flex justify-content-between align-items-center">
                            <div class="page-separator w-100">
                                <div class="page-separator__text">Course Portals</div>
                            </div>
                            <button type="button" class="btn btn-primary ml-2 bg-dark" data-bs-toggle="modal"
                                data-bs-target="#myModal" id="btnAdd">
                                New
                            </button>
                            <!-- Button trigger modal -->
                        </div>




                        <div class="card table-responsive mb-24pt" style="padding-top: 20px; overflow: hidden;">

                            <table id="tbl" class="table table-flush table--elevated">
                                <thead class="table-headings">
                                    <tr>
                                        <th>Course Name</th>
                                        
                                        <th>Edit</th>
                                        <th>Delete</th>
                                    </tr>
                                </thead>
                                <tbody>

                                </tbody>
                            </table>

                        </div>
                    </div>
                </div>
            </div>

            <div id="myFooter"></div>
        </div>

        <!-- // END drawer-layout__content -->

        <!-- Drawer -->

        <div class="mdk-drawer js-mdk-drawer" id="default-drawer">
            <div class="mdk-drawer__content">
                <div class="sidebar sidebar-black-dodger-blue sidebar-left" data-perfect-scrollbar>
                    <div id="mySidebar"></div>
                    <!-- Sidebar Content -->
                </div>
            </div>

            <!-- // END Drawer -->

        </div>
    </div>


    <!-- // END Drawer Layout -->

    <!-- Header -->
    <script src="components/header.js"></script>

    <!-- Footer -->
    <script src="components/footer.js"></script>

    <!-- sidebar -->
    <script src="components/sidebar.js"></script>
    <!-- jQuery -->
    <script src="public/vendor/jquery.min.js"></script>

    <!-- Bootstrap -->
    <script src="myJS/bootstrap.bundle.min.js"></script>
    <script src="public/vendor/popper.min.js"></script>
    <script src="public/vendor/bootstrap.min.js"></script>

    <!-- Perfect Scrollbar -->
    <script src="public/vendor/perfect-scrollbar.min.js"></script>

    <!-- DOM Factory -->
    <script src="public/vendor/dom-factory.js"></script>

    <!-- MDK -->
    <script src="public/vendor/material-design-kit.js"></script>

    <!-- App JS -->
    <script src="public/js/app.js"></script>

    <!-- Preloader -->
    <script src="public/js/preloader.js"></script>


    <!-- added scripts not included in template -->
    <!-- Datatable js-->
    <script src="myJS/datatables/jquery.dataTables.min.js"></script>
    <script src="myJS/datatables/custom-basic.js"></script>
    <script src="myJS/QueryStringDivider.js"></script>

    <script>
        $(document).ready(function () {
// Get the search parameters from the URL
const urlParams = new URLSearchParams(window.location.search);

// Get the value of the 'trainerId' parameter
const trainerId = urlParams.get('trainerId');

// Log the retrieved trainerId to the console for verification
console.log(trainerId);

            var numRows = 0; // number of rows for a datatable
            // document.getElementById('toggleButton').addEventListener('click', function () {
            //     var icon = this.querySelector('i');

            //     // Toggle between X and check mark icons
            //     if (icon.classList.contains('fa-times')) {
            //         icon.classList.remove('fa-times');
            //         icon.classList.add('fa-check');
            //     } else {
            //         icon.classList.remove('fa-check');
            //         icon.classList.add('fa-times');
            //     }

            //     // You can add logic here to handle the boolean value based on the icon state
            //     $('#isActive').val(icon.classList.contains('fa-times') ? 0 : 1);
            //     // console.log('Boolean Value:', booleanValue);
            // });

            var url;
            url = "api/";


            var dataTable = $('#tbl').DataTable({

                "ajax": {
                    url: url + "vwCourses.php?status=coursesByTRainer&trainerId="+trainerId,
                    "dataSrc": "",
                    type: "POST",
                },
                destroy: true,
                "deferRender": true,
                "columns": [
                    { data: "courseName" },
                   
                    {
                        "data": "courseId",
                        render: function (data, type, row) {
                            return `<span class='edit' data-id= ${data} data-bs-toggle="modal" data-bs-target="#myModal"><i class="fa fa-edit"></i></span>`;
                        }
                    },
                    {
                        "data": "courseId",
                        render: function (data, type, row) {
                            return `<span class='delete' data-id=` + data + ` ><i class="fa fa-trash"></i></span>`;
                        }
                    }
                ],
                initComplete: function (settings, json) {


                    // You can access the DataTable instance using `this`
                    // var dataTable = this;

                    // For example, you can get the number of rows
                    var numRows = dataTable.rows().count();

                    setNumberOfRows(numRows);
                }
            });

            function setNumberOfRows(n) {
                $('#nbrOfPortals').html(n);
            }

            $('#myModal').on('shown.bs.modal', function () {
                // Set focus to the input when the modal is shown and select the text
                $('#courseName').focus();
                $('#courseName').select();
            });

            $('#tbl tbody').on('click', '.edit', function () {
                // get the id value stored in the edit button

                var id = $(this).data("id");
                // var row = dataTable.row($(this).parents('tr'));
                // var rowData = row.data();
                // console.log(rowData);
                // displayPortal(id, rowData.courseName,trainerId)
                console.log("Trainer ID:", trainerId);
                window.location.href = 'instructor-edit-course.html?trainerId=' + trainerId + '&courseId=' + id;


            });

            $('#tbl tbody').on('click', '.delete', function () {
                if (confirm("Are your sure you want to delete?")) {
                    var row = $(this).parents('tr');


                    var id = $(this).data("id");

                    var str = "id=" + id + "&status=delete";
                    console.log(str);
                    $.ajax({
                        url: url + 'vwCourses.php', data: str, type: 'post', dataType: 'json',
                        success: function (Arr) {
                            dataTable.row(row).remove().draw();
                        },
                        error: function (E) { alert(E.status + E.statusText) }
                    });
                }
            });

            $('#btnAdd').on('click', function () {
               // displayPortal(-1, '', trainerId)
               window.location.href = 'instructor-edit-course.html';

            })

            function displayPortal(courseId, courseName,trainerId) {
                $('#courseId').val(courseId);
                $('#courseName').val(courseName);
                $('#trainerId').val(trainerId);
            //    $('#isActive').val(isActive);
            //     var icon = document.getElementById('icon');
            //     if (isActive == 1) {
            //         icon.classList.remove('fa-times');
            //         icon.classList.add('fa-check');
            //     } else {
            //         icon.classList.add('fa-times');
            //         icon.classList.remove('fa-check');
            //     }

            }

            $('#myForm').on('submit', function (e) {
                e.preventDefault()
                // var checkbox = document.getElementById('isActive');
                // checkbox.value = checkbox.checked ? '0' : '1';
                // str = decodeURIComponent($('#myForm').serialize());
                var formData = new FormData(this)
                // if (checkbox.value == 1) {
                //     str += "&isActive=" + '1'
                // }
                // console.log(checkbox.value);

                var id = $('#courseId').val();	// get the value of the id  input text that is hidden in the modal form
               console.log(id)
                var status = (id == -1) ? 'new' : 'update';
                console.log(status)
                // str += "&status=" + status;
               
                formData.append('status', status)

                // console.log(str);
                /////////////////////
                // call the php api to update or insert the data
                $.ajax({
                    url: url + 'vwCourses.php', data: formData, type: 'post', dataType: 'json',
                    contentType: false,
                    processData: false,
                    success: function (response) {
                        // create a new row with the data returned from api

                        console.log("id",id);
                        if (id == -1) {
                            var newRowData = {
                                courseId: response.courseId,
                                courseName: $('#courseName').val(),
                                trainerId: $('#trainerId').val()

                            }
                           
                            // if the operation is insert then add the row to the data table
                            dataTable.row.add(newRowData).draw();
                        } else {
                            
                            // if it is update then modify the row in the data table
                            // first get the row index of the row that contains the id
                            var newRowData = {
                                courseId: id,
                                courseName: $('#courseName').val(),
                                trainerId: $('#trainerId').val()
                              //  isActive: $('#isActive').val(),
                            }
                            
                            
                            //console.log(rowIndex);
                            var rowId = dataTable.row(function (idx, data, node) {
                                return data['courseId'] == id;
                            });
                            //console.log(rowId);
                            var rowIndex = rowId[0][0]
                            dataTable.row(rowIndex).data(newRowData).draw();
                        }
                        $('#myModal').modal('hide');

                    },
                    error: function(xhr) {
                        console.error(xhr.responseText);
                    }
                });
            })
        });

    </script>




</body>

</html>